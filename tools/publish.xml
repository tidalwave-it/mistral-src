<?xml version="1.0" encoding="UTF-8"?>
<!--
Mistral - open source imaging engine
====================================

Project home page: http://mistral.tidalwave.it

==============================================================================

Copyright (C) 2003-2007 by Fabrizio Giudici (Fabrizio.Giudici@tidalwave.it)
                       and Emmanuele Sordini (Emmanuele@Sordini.com)

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

==============================================================================

$Id: publish.xml 611 2007-04-08 19:33:17Z fabriziogiudici $
-->

<project name="publish" default="jar" basedir=".">

    <!-- =======================================================================

    

    ======================================================================== -->
    <target name="publish-release" depends="distribution">
        <javaNetUpload projectName="${java.net.projectURL}"
                       toFile="Releases/${Release}/${java.net.projectName}-${tag}-src.zip"
                       fromFile="dist/${java.net.projectName}-${tag}-src.zip"
                       fileDescription="Source files"
                       fileStatus="Stable"/>
        <javaNetUpload projectName="${java.net.projectURL}"
                       toFile="Releases/${Release}/${java.net.projectName}-${tag}-bin.zip"
                       fromFile="dist/${java.net.projectName}-${tag}-bin.zip"
                       fileDescription="Binary distribution"
                       fileStatus="Stable"/>
    </target>

    <!-- =======================================================================

    

    ======================================================================== -->
    <target name="publish-snapshot" depends="distribution">
        <javaNetUpload projectName="${java.net.projectURL}"
                       toFile="Nightly builds/Sources/${java.net.projectName}-${tag}-src.zip"
                       fromFile="dist/${java.net.projectName}-${tag}-src.zip"
                       fileDescription="Source files"
                       fileStatus="Draft"/>
        <javaNetUpload projectName="${java.net.projectURL}"
                       toFile="Nightly builds/Binaries/${java.net.projectName}-${tag}-bin.zip"
                       fromFile="dist/${java.net.projectName}-${tag}-bin.zip"
                       fileDescription="Binary distribution"
                       fileStatus="Draft"/>
    </target>

    <!-- =======================================================================

    

    ======================================================================== -->
    <target name="distribution" depends="clean, gettag, jar, javadoc, src-zip, bin-zip"/>

    <!-- =======================================================================

    

    ======================================================================== -->
    <target name="src-zip" depends="gettag">
	<mkdir dir="dist"/>
	<delete file="dist/${java.net.projectName}-${tag}-src.zip" failonerror="false"/>
	<zip destfile="dist/${java.net.projectName}-${tag}-src.zip">
            <zipfileset dir="." 
                        prefix="${java.net.projectName}-${tag}" 
                        excludes="**/.svn/**,**/build/**,**/dist/**,**/nbproject/private/**,dist/**,Rio*/**, **/image.properties*, **/log/**"/>
        </zip>
    </target>

    <!-- =======================================================================

    

    ======================================================================== -->
    <target name="bin-zip" depends="gettag">
	<mkdir dir="dist"/>
	<delete file="dist/${java.net.projectName}-${tag}-bin.zip" failonerror="false"/>
	<zip destfile="dist/${java.net.projectName}-${tag}-bin.zip">
            <zipfileset dir="." 
                        prefix="${java.net.projectName}-${tag}" 
                        excludes="**/.svn/**,**/src/**,**/build/**,**/nbproject/**,**/test/**,**/build.xml,dist/**,lib/**,Rio*/**, **/image.properties*, tools/**, **/log/** "/>
        </zip>
    </target>

    <!-- =======================================================================

    Retrieves the current revision number from the subversion facility.

    ======================================================================== -->
    <target name="gettag">
        <delete failonerror="false" file="subversion.properties" />
        <exec command="svn info -r HEAD" output="subversion.properties"/>
        <property file="subversion.properties"/>
        <property file="RELEASE"/>
        <property name="tag" value="${Release}.${Revision}"/>
        <delete failonerror="false" file="subversion.properties" />
        <echo message="Current tag is ${tag}..." />
        <echo message="PLEASE VERIFY THAT THE CURRENT TAG IS DIFFERENT THAN THE PREVIOUS RELEASE" />
    </target>
</project>
